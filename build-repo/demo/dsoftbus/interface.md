# 分布式软总线对外接口列表

## 常用接口

| 功能模块 | 接口功能              | 接口定义                                                                                                                                                  | 参数说明                                | 返回值                                                                           |
|------|-------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------|-------------------------------------------------------------------------------|
| 发现连接 | 设备发布特定能力          | int32_t PublishLNN(const char *pkgName, const PublishInfo *info, const IPublishCb *cb)                                                                | pkgName: 服务的包名，最大64字节               | SOFTBUS_OK: 成功发布<br/>其他返回码：发布失败的错误码                                           |
|      |                   |                                                                                                                                                       | info: 需要发布的信息                       |                                                                               |
|      |                   |                                                                                                                                                       | cb: 发布的回调函数，用于通知发布结果                |                                                                               |
|      | 设备取消发布特定能力        | int32_t StopPublishLNN(const char *pkgName, int32_t publishId)                                                                                        | pkgName: 服务的包名                      | SOFTBUS_OK: 成功发布<br/>其他返回码：发布失败的错误码                                           |
|      |                   |                                                                                                                                                       | publishId: 发布Id                     |                                                                               |
|      | 设备发现某种能力          | int32_t RefreshLNN(const char *pkgName, const SubscribeInfo *info, const IRefreshCallback *cb)                                                        | pkgName: 服务的包名                      | SOFTBUS_OK: 成功发布<br/>其他返回码：发布失败的错误码                                           |
|      |                   |                                                                                                                                                       | info: 指定需要发现的设备信息                   |                                                                               |
|      |                   |                                                                                                                                                       | cb: 发现的回调函数，用户通知发现结果                |                                                                               |
|      | 设备取消发现能力          | int32_t StopRefreshLNN(const char *pkgName, int32_t refreshId)                                                                                        | pkgName: 服务的包名                      | SOFTBUS_OK: 成功发布<br/>其他：发布失败的错误码                                              |
|      |                   |                                                                                                                                                       | refreshId: 订阅Id                     |                                                                               |
| 组网   | 获取组网内所有设备信息       | int32_t GetAllNodeDeviceInfo(const char *pkgName, NodeBasicInfo **info, int32_t *infoNum)                                                             | pkgName: 服务的包名                      | 0: 成功获取到设备信息<br/>其他：获取失败的错误码                                                  |
|      |                   |                                                                                                                                                       | info: 用于存储设备信息的内存地址                 |                                                                               |
|      |                   |                                                                                                                                                       | infoNum: 设备个数                       |                                                                               |
|      | 获取当前设备信息          | int32_t GetLocalNodeDeviceInfo(const char *pkgName, NodeBasicInfo *info)                                                                              | pkgName: 服务的包名                      | 0: 成功获取到设备信息<br/>其他：获取失败的错误码                                                  |
|      |                   |                                                                                                                                                       | info: 用于存储设备信息的内存地址                 |                                                                               |
|      | 根据netWorkID获取设备信息 | int32_t GetNodeKeyInfo(const char *pkgName, const char *networkId,NodeDeviceInfoKey key, uint8_t *info, int32_t infoLen)                              | pkgName: 服务的包名                      | 0: 成功获取到设备的指定信息<br/>其他：获取失败的错误码                                               |
|      |                   |                                                                                                                                                       | networkId: 标识设备的网络id                |                                                                               |
|      |                   |                                                                                                                                                       | key: 用于指定获取设备的什么信息                  |                                                                               |
|      |                   |                                                                                                                                                       | info: 用于存储设备信息的内存地址                 |                                                                               |
|      |                   |                                                                                                                                                       | infoLen: 返回的信息长度                    |                                                                               |
| 传输   | 创建会话服务            | int CreateSessionServer(const char *pkgName, const char *sessionName, const ISessionListener *listener)                                               | pkgName: 服务的包名                      | 0: 成功创建会话服务<br/>其他：创建会话服务失败的错误码                                               |
|      |                   |                                                                                                                                                       | sessionName: 设置的会话名称                |                                                                               |
|      |                   |                                                                                                                                                       | listener: 注册此会话的一系列回调，用于监听会话状态      |                                                                               |
|      | 移除会话服务            | int RemoveSessionServer(const char *pkgName, const char *sessionName)                                                                                 | pkgName: 服务的包名                      | 0: 成功移除会话服务<br/>其他：移除会话服务失败的错误码                                               |
|      |                   |                                                                                                                                                       | sessionName: 会话名称                   |                                                                               |
|      | 打开传输会话            | int OpenSession(const char *mySessionName, const char *peerSessionName, const char *peerNetworkId, const char *groupId, const SessionAttribute* attr) | mySessionName: 本端设备的会话名称            | > 0: 会话Id<br/>其他：打开会话失败的错误码<br/>（注意：会话是否真正打开成功是由注册给会话的回调函数确定，此接口并不能真正表示会话打开了） |
|      |                   |                                                                                                                                                       | peerSessionName: 对端设备的会话名称          |                                                                               |
|      |                   |                                                                                                                                                       | peerNetworkId: 对端设备的网络id            |                                                                               |
|      |                   |                                                                                                                                                       | groupId: 会话所属的群组id                  |                                                                               |
|      |                   |                                                                                                                                                       | attr: 打开会话的属性，指定传输介质/连接类型等          |                                                                               |
|      | 关闭传输会话            | void CloseSession(int sessionId)                                                                                                                      | sessionId: 关闭的会话id，openSession时返回的值 | 无                                                                             |
|      | 发送字节              | int SendBytes(int sessionId, const void *data, unsigned int len)                                                                                      | sessionId: 用来传输的会话Id                | SOFTBUS_OK：数据传输成功<br/>其他：数据传输失败                                               |
|      |                   |                                                                                                                                                       | data: 传输的字符数据                       |                                                                               |
|      |                   |                                                                                                                                                       | len: 传输的字符数据长度                      |                                                                               |
|      | 发送流               | int SendStream(int sessionId, const StreamData *data, const StreamData *ext, const StreamFrameInfo *param)                                            | sessionId: 会话Id                     | SOFTBUS_OK：数据传输成功<br/>其他：数据传输失败                                               |
|      |                   |                                                                                                                                                       | data: 用于传输的流数据                      |                                                                               |
|      |                   |                                                                                                                                                       | ext: 传输的扩展信息                        |                                                                               |
|      |                   |                                                                                                                                                       | param: 帧信息                          |

## 发现接口

**注意：`PublishService`/`UnPublishService`/`StartDiscovery`和`StopDiscovery` 四个接口已不推荐使用，推荐使用`PublishLNN`/`StopPublishLNN`/`RefreshLNN`和`StopRefreshLNN`**

| 功能模块                                | 接口功能       | 接口定义                                                                                             | 参数说明                  | 返回值                                 |
|-------------------------------------|------------|--------------------------------------------------------------------------------------------------|-----------------------|-------------------------------------|
| 发现连接                                | 设备发布特定能力   | int32_t PublishLNN(const char *pkgName, const PublishInfo *info, const IPublishCb *cb)           | pkgName: 服务的包名，最大64字节 | SOFTBUS_OK: 成功发布<br/>其他返回码：发布失败的错误码 |
|                                     |            |                                                                                                  | info: 需要发布的信息         |                                     |
|                                     |            |                                                                                                  | cb: 发布的回调函数，用于通知发布结果  |                                     |
|                                     | 设备取消发布特定能力 | int32_t StopPublishLNN(const char *pkgName, int32_t publishId)                                   | pkgName: 服务的包名        | SOFTBUS_OK: 成功发布<br/>其他返回码：发布失败的错误码 |
|                                     |            |                                                                                                  | publishId: 发布Id       |                                     |
|                                     | 设备发现某种能力   | int32_t RefreshLNN(const char *pkgName, const SubscribeInfo *info, const IRefreshCallback *cb)   | pkgName: 服务的包名        | SOFTBUS_OK: 成功发布<br/>其他返回码：发布失败的错误码 |
|                                     |            |                                                                                                  | info: 指定需要发现的设备信息     |                                     |
|                                     |            |                                                                                                  | cb: 发现的回调函数，用户通知发现结果  |                                     |
|                                     | 设备取消发现能力   | int32_t StopRefreshLNN(const char *pkgName, int32_t refreshId)                                   | pkgName: 服务的包名        | SOFTBUS_OK: 成功发布<br/>其他：发布失败的错误码    |
|                                     |            |                                                                                                  | refreshId: 订阅Id       |                                     |
| 发现连接<br/>（已不推荐使用） | 设备发布特定能力   | int PublishService(const char *pkgName, const PublishInfo *info, const IPublishCallback *cb)     | pkgName: 服务的包名，最大64字节 | SOFTBUS_OK: 成功发布<br/>其他返回码：发布失败的错误码 |
|                                     |            |                                                                                                  | info: 需要发布的信息         |                                     |
|                                     |            |                                                                                                  | cb: 发布的回调函数，用于通知发布结果  |                                     |
|                                     | 设备取消发布特定能力 | int UnPublishService(const char *pkgName, int publishId)                                         | pkgName: 服务的包名        | SOFTBUS_OK: 成功发布<br/>其他返回码：发布失败的错误码 |
|                                     |            |                                                                                                  | publishId: 发布Id       |                                     |
|                                     | 设备发现某种能力   | int StartDiscovery(const char *pkgName, const SubscribeInfo *info, const IDiscoveryCallback *cb) | pkgName: 服务的包名        | SOFTBUS_OK: 成功发布<br/>其他返回码：发布失败的错误码 |
|                                     |            |                                                                                                  | info: 指定需要发现的设备信息     |                                     |
|                                     |            |                                                                                                  | cb: 发现的回调函数，用户通知发现结果  |                                     |
|                                     | 设备取消发现能力   | int StopDiscovery(const char *pkgName, int subscribeId)                                          | pkgName: 服务的包名        | SOFTBUS_OK: 成功发布<br/>其他：发布失败的错误码    |
|                                     |            |                                                                                                  | refreshId: 订阅Id       |

## 组网接口

| 功能模块 | 接口功能                            | 接口定义                                                                                                                                       | 参数说明                         | 返回值                                    |
|------|---------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------|------------------------------|----------------------------------------|
| 组网   | 手动和某个设备进行组网                     | int32_t JoinLNN(const char *pkgName, ConnectionAddr *target, OnJoinLNNResult cb)                                                           | pkgName: 服务的包名               | 0: 组网成功，后续组网状态通过回调函数获取<br/>其他：组网失败的错误码 |
|      |                                 |                                                                                                                                            | target: 对端设备的地址              |                                        |
|      |                                 |                                                                                                                                            | cb: 组网结果/状态的处理回调             |                                        |
|      | 手动离开某个网络                        | int32_t LeaveLNN(const char *pkgName, const char *networkId, OnLeaveLNNResult cb)                                                          | pkgName: 服务的包名               | 0: 成功<br/>其他：失败错误码                     |
|      |                                 |                                                                                                                                            | networkId: 网络ID              |                                        |
|      |                                 |                                                                                                                                            | cb: 处理结果的回调                  |                                        |
|      | 激活元节点                           | int32_t ActiveMetaNode(const char *pkgName, const MetaNodeConfigInfo *info, char *metaNodeId)                                              | pkgName: 服务的包名               | 0: 成功<br/>其他：失败错误码                     |
|      |                                 |                                                                                                                                            | info: 设置的元节点信息               |                                        |
|      |                                 |                                                                                                                                            | metaNodeId: 存储激活元节点之后的元节点ID  |                                        |
|      | 关闭元节点                           | int32_t DeactiveMetaNode(const char *pkgName, const char *metaNodeId)                                                                      | pkgName: 服务的包名               | 0: 成功<br/>其他：失败错误码                     |
|      |                                 |                                                                                                                                            | metaNodeId: 元节点ID            |                                        |
|      | 手动加入某个元节点                       | int32_t JoinMetaNode(const char *pkgName, ConnectionAddr *target, CustomData *customData, OnJoinMetaNodeResult cb)                         | pkgName: 服务的包名               | 0: 加入元节点成功<br/>其他：失败的错误码               |
|      |                                 |                                                                                                                                            | target: 对端设备的地址              |                                        |
|      |                                 |                                                                                                                                            | customData: 自定义数据，包含特定设备的key |                                        |
|      |                                 |                                                                                                                                            | cb: 处理结果的回调                  |                                        |
|      | 手动离开某个元节点                       | int32_t LeaveMetaNode(const char *pkgName, const char *networkId, OnLeaveMetaNodeResult cb)                                                | pkgName: 服务的包名               | 0: 成功<br/>其他：失败错误码                     |
|      |                                 |                                                                                                                                            | networkId: 网络ID              |                                        |
|      |                                 |                                                                                                                                            | cb: 处理结果的回调                  |                                        |
|      | 注册设备状态变化监听回调                    | int32_t RegNodeDeviceStateCb(const char *pkgName, INodeStateCb *callback)                                                                  | pkgName: 服务的包名               | 0: 成功<br/>其他：失败错误码                     |
|      |                                 |                                                                                                                                            | callback: 设备不同状态变化的处理回调      |                                        |
|      | 注销设备状态变化的监听回调                   | int32_t UnregNodeDeviceStateCb(INodeStateCb *callback)                                                                                     | callback: 注册过的回调函数集合         | 0: 成功<br/>其他：失败错误码                     |
| 信息获取 | 获取组网内所有在线设备信息                   | int32_t GetAllNodeDeviceInfo(const char *pkgName, NodeBasicInfo **info, int32_t *infoNum)                                                  | pkgName: 服务的包名               | 0: 成功获取到设备信息<br/>其他：获取失败的错误码           |
|      |                                 |                                                                                                                                            | info: 用于存储设备信息的内存地址          |                                        |
|      |                                 |                                                                                                                                            | infoNum: 设备个数                |                                        |
|      | 获取当前设备信息                        | int32_t GetLocalNodeDeviceInfo(const char *pkgName, NodeBasicInfo *info)                                                                   | pkgName: 服务的包名               | 0: 成功获取到设备信息<br/>其他：获取失败的错误码           |
|      |                                 |                                                                                                                                            | info: 用于存储设备信息的内存地址          |                                        |
|      | 根据netWorkID获取设备信息               | int32_t GetNodeKeyInfo(const char *pkgName, const char *networkId,NodeDeviceInfoKey key, uint8_t *info, int32_t infoLen)                   | pkgName: 服务的包名               | 0: 成功获取到设备的指定信息<br/>其他：获取失败的错误码        |
|      |                                 |                                                                                                                                            | networkId: 标识设备的网络id         |                                        |
|      |                                 |                                                                                                                                            | key: 用于指定获取设备的什么信息           |                                        |
|      |                                 |                                                                                                                                            | info: 用于存储设备信息的内存地址          |                                        |
|      |                                 |                                                                                                                                            | infoLen: 返回的信息长度             |                                        |
|      | 释放GetAllNodeDeviceInfo返回的节点信息内存 | void FreeNodeInfo(NodeBasicInfo *info)                                                                                                     | info: 节点信息的内存地址              | 无                                      |
|      | 获取所有元节点信息                       | int32_t GetAllMetaNodeInfo(const char *pkgName, MetaNodeInfo *infos, int32_t *infoNum)                                                     | pkgName: 服务的包名               | 0: 成功<br/>其他：失败错误码                     |
|      |                                 |                                                                                                                                            | infos: 用来存储元节点信息的内存          |                                        |
|      |                                 |                                                                                                                                            | infoNum: 元节点个数               |                                        |
| 时间心跳 | 进行设备间时间同步                       | int32_t StartTimeSync(const char *pkgName, const char *targetNetworkId, TimeSyncAccuracy accuracy,TimeSyncPeriod period, ITimeSyncCb *cb); | pkgName: 服务的包名               | 0: 成功<br/>其他：失败错误码                     |
|      |                                 |                                                                                                                                            | targetNetworkId: 对端设备id      |                                        |
|      |                                 |                                                                                                                                            | accuracy: 时间精度               |                                        |
|      |                                 |                                                                                                                                            | period: 时间周期                 |                                        |
|      |                                 |                                                                                                                                            | cb: 时间同步的结果处理回调              |                                        |
|      | 停止设备间时间同步                       | int32_t StopTimeSync(const char *pkgName, const char *targetNetworkId)                                                                     | pkgName: 服务的包名               | 0: 成功<br/>其他：失败错误码                     |
|      |                                 |                                                                                                                                            | targetNetworkId: 对端设备id      |                                        |
|      | 修改心跳参数并触发一次临时心跳                 | int32_t ShiftLNNGear(const char *pkgName, const char *callerId, const char *targetNetworkId, const GearMode *mode)                         | pkgName: 服务的包名               | 0: 成功<br/>其他：失败错误码                     |
|      |                                 |                                                                                                                                            | callerId: 调用者ID，最大128字节      |                                        |
|      |                                 |                                                                                                                                            | targetNetworkId: 对端设备id      |                                        |
|      |                                 |                                                                                                                                            | mode: 心跳周期/持续时间等参数           |

## 传输接口

| 功能模块 | 接口功能          | 接口定义                                                                                                                                                  | 参数说明                                | 返回值                                                                           |
|------|---------------|-------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------|-------------------------------------------------------------------------------|
| 传输   | 创建会话服务        | int CreateSessionServer(const char *pkgName, const char *sessionName, const ISessionListener *listener)                                               | pkgName: 服务的包名                      | 0: 成功创建会话服务<br/>其他：创建会话服务失败的错误码                                               |
|      |               |                                                                                                                                                       | sessionName: 设置的会话名称                |                                                                               |
|      |               |                                                                                                                                                       | listener: 注册此会话的一系列回调，用于监听会话状态      |                                                                               |
|      | 移除会话服务        | int RemoveSessionServer(const char *pkgName, const char *sessionName)                                                                                 | pkgName: 服务的包名                      | 0: 成功移除会话服务<br/>其他：移除会话服务失败的错误码                                               |
|      |               |                                                                                                                                                       | sessionName: 会话名称                   |                                                                               |
|      | 打开传输会话        | int OpenSession(const char *mySessionName, const char *peerSessionName, const char *peerNetworkId, const char *groupId, const SessionAttribute* attr) | mySessionName: 本端设备的会话名称            | > 0: 会话Id<br/>其他：打开会话失败的错误码<br/>（注意：会话是否真正打开成功是由注册给会话的回调函数确定，此接口并不能真正表示会话打开了） |
|      |               |                                                                                                                                                       | peerSessionName: 对端设备的会话名称          |                                                                               |
|      |               |                                                                                                                                                       | peerNetworkId: 对端设备的网络id            |                                                                               |
|      |               |                                                                                                                                                       | groupId: 会话所属的群组id                  |                                                                               |
|      |               |                                                                                                                                                       | attr: 打开会话的属性，指定传输介质/连接类型等          |                                                                               |
|      | 关闭传输会话        | void CloseSession(int sessionId)                                                                                                                      | sessionId: 关闭的会话id，openSession时返回的值 | 无                                                                             |
|      | 发送字节          | int SendBytes(int sessionId, const void *data, unsigned int len)                                                                                      | sessionId: 用来传输的会话Id                | SOFTBUS_OK：数据传输成功<br/>其他：数据传输失败                                               |
|      |               |                                                                                                                                                       | data: 传输的字符数据                       |                                                                               |
|      |               |                                                                                                                                                       | len: 传输的字符数据长度                      |                                                                               |
|      | 发送流           | int SendStream(int sessionId, const StreamData *data, const StreamData *ext, const StreamFrameInfo *param)                                            | sessionId: 会话Id                     | SOFTBUS_OK：数据传输成功<br/>其他：数据传输失败                                               |
|      |               |                                                                                                                                                       | data: 用于传输的流数据                      |                                                                               |
|      |               |                                                                                                                                                       | ext: 传输的扩展信息                        |                                                                               |
|      |               |                                                                                                                                                       | param: 帧信息                          |                                                                               |
|      | 发送消息          | int SendMessage(int sessionId, const void *data, unsigned int len)                                                                                    | sessionId: 用来传输的会话Id                | SOFTBUS_OK：数据传输成功<br/>其他：数据传输失败                                               |
|      |               |                                                                                                                                                       | data: 传输的消息数据                       |                                                                               |
|      |               |                                                                                                                                                       | len: 传输的消息数据长度                      |                                                                               |
|      | 获取本端会话名称      | int GetMySessionName(int sessionId, char *sessionName, unsigned int len)                                                                              | sessionId: 会话ID                     | SOFTBUS_OK：获取成功<br/>其他：失败的错误码                                                 |
|      |               |                                                                                                                                                       | sessionName: 用来存储会话名称的内存地址          |                                                                               |
|      |               |                                                                                                                                                       | len: 内存长度                           |                                                                               |
|      | 获取对端会话名称      | int GetPeerSessionName(int sessionId, char *sessionName, unsigned int len)                                                                            | sessionId: 会话ID                     | SOFTBUS_OK：获取成功<br/>其他：失败的错误码                                                 |
|      |               |                                                                                                                                                       | sessionName: 用来存储会话名称的内存地址          |                                                                               |
|      |               |                                                                                                                                                       | len: sessionName内存长度                |                                                                               |
|      | 获取对端设备ID      | int GetPeerDeviceId(int sessionId, char *networkId, unsigned int len)                                                                                 | sessionId: 会话ID                     | SOFTBUS_OK：获取成功<br/>其他：失败的错误码                                                 |
|      |               |                                                                                                                                                       | networkId: 用来存储设备ID的内存地址            |                                                                               |
|      |               |                                                                                                                                                       | len: networkId的内存长度                 |                                                                               |
|      | 判断会话是服务端还是客户端 | int GetSessionSide(int sessionId)                                                                                                                     | sessionId: 会话ID                     | -1: 获取失败<br/>0: 服务端<br/>1: 客户端                                                |
|      | 设置文件接收监听器     | int SetFileReceiveListener(const char *pkgName, const char *sessionName,<br/>    const IFileReceiveListener *recvListener, const char *rootDir)       | pkgName: 服务的包名                      | SOFTBUS_OK: 设置成功<br/>其他：失败的错误码                                                |
|      |               |                                                                                                                                                       | sessionName: 监听的会话名                 |                                                                               |
|      |               |                                                                                                                                                       | recvListener: 注册的监听器内容              |                                                                               |
|      |               |                                                                                                                                                       | rootDir: 监听的根目录                     |                                                                               |
|      | 设置文件发送监听器     | int SetFileSendListener(const char *pkgName, const char *sessionName, const IFileSendListener *sendListener)                                          | pkgName: 服务的包名                      | SOFTBUS_OK: 设置成功<br/>其他：失败的错误码                                                |
|      |               |                                                                                                                                                       | sessionName: 会话名                    |                                                                               |
|      |               |                                                                                                                                                       | sendListener: 文件发送的监听器，回调函数集合       |                                                                               |
|      | 发送文件          | int SendFile(int sessionId, const char *sFileList[], const char *dFileList[], uint32_t fileCnt)                                                       | sessionId: 会话ID                     | SOFTBUS_OK: 请求成功发送到服务端<br/>其他：失败的错误码                                          |
|      |               |                                                                                                                                                       | sFileList: 发送的源文件列表                 |                                                                               |
|      |               |                                                                                                                                                       | dFileList: 发送到对端的目标文件列表             |                                                                               |
|      |               |                                                                                                                                                       | fileCnt: 文件个数                       |                                                                               |
|      | 获取会话          | int GetSessionOption(int sessionId, SessionOption option, void* optionValue, uint32_t valueSize)                                                      | sessionId: 会话ID                     | SOFTBUS_OK: 获取成功<br/>其他：失败的错误码                                                |
|      |               |                                                                                                                                                       | option: 需要获取的session类型              |                                                                               |
|      |               |                                                                                                                                                       | optionValue: 用来存储获取的会话选项信息          |                                                                               |
|      |               |                                                                                                                                                       | valueSize: optionValue的内存大小         |